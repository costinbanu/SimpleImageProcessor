@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<script>
    function submitAttachments() {
        $('#uploadForm').submit();
        $('#fileUploadStatus').text('Se încarcă fișierele...');
    }

    var maxWidth, maxHeight;

    function resizeImage(img) {
        maxWidth = maxWidth || $('#images').width() - 20;
        maxHeight = maxHeight || $(window).innerHeight() - $('#topBanner').outerHeight() - 40;
        var originalWidth = img.naturalWidth,
            originalHeight = img.naturalHeight,
            ratio = Math.min(maxHeight / originalHeight, maxWidth / originalWidth);
        if (ratio < 1) {
            $(img).css({ 'width': Math.round(originalWidth * ratio) + 'px', 'height': Math.round(originalHeight * ratio) + 'px' });

        }
    }

    //function resizeAll() {
    //    $('#images').find('img').each(function (_, img) {
    //        resizeImg(img);
    //    });
    //}

    //$(document).ready(function () {
    //    window.onload = function () {
    //        resizeAll();
    //    }
    //});
</script>

<h2>Procesor imagini</h2>
<br />
<h3>Ascunde numere de înmatriculare și redimensionează imaginile de peste 2MB</h3>
<br />
Încarcă fișierele, ele vor fi apoi procesate, iar la final vor fi afișate în pagină. Alege să le salvezi pe fiecare în parte din meniul click dreapta 🡒 salvează imaginea...
<br />
Această unealtă este un soft experimental și poate returna rezultate neașteptate sau greșite. Te rugăm să verifici cu atenție rezultatul înainte să îl folosești.
<br />
<p>&nbsp;</p>
<form method="post" id="uploadForm" enctype="multipart/form-data">
    <input asp-for="Files" onchange="submitAttachments()" multiple />
    <div class="caption">Minim 1, maxim 10 fișiere.</div>
    <div id="fileUploadStatus"></div>
    <span style="color:darkred; font-weight:bold;" asp-validation-for="Files"></span>
</form>
<p>&nbsp;</p>
<div style="width:100%" id="images">
    @for (var i = 0; i < Model.Count; i++)
    {
        <img src="./File?id=@i&sessionId=@Model.SessionId" onload="resizeImage(this)" />
        <p>&nbsp;</p>
    }
</div>
<p class="caption">
    Acest soft este pus la dispoziția publicului ca atare, fără garanții, și poate fi folosit în mod liber și gratuit, fără alte restricții. Echipa Metrou Ușor nu își asumă responsabilitatea pentru posibilele
    daune cauzate de folosirea acestui soft.
</p>
<p class="caption">
    Numerele de înmatriculare detectate în imagini nu sunt salvate nici pe acest server, nici pe servere terțe. Similar, nici imaginile procesate nu sunt salvate nici pe acest server, nici pe servere terțe,
    nici înainte, nici în timpul și nici după procesare.
</p>
<p class="caption">
    Motorul de detecție a numerelor de înmatriculare în imagini este furnizat de <a href="https://www.openalpr.com/">openALPR</a>.
</p>

